steps:
- id: build dd image
  uses: docker://docker:19.03.3
  args: [
    'build',
    '-t',
    'jcnitdgp25/dd:latest',
    './dd/dd-image'
  ]

- id: push dd image to dockerhub
  uses: docker://docker:19.03.3
  secrets: [
    'DOCKER_USERNAME',
    'DOCKER_PASSWORD'
  ]
  runs: ['/bin/sh']
  args:
  - -c
  - |
    docker login -u $DOCKER_USERNAME -p $DOCKER_PASSWORD
    docker push jcnitdgp25/dd:latest

- id: setup dd tests
  uses: docker://bitnami/kubectl:1.17.4
  runs: ['./dd/setup_dd_tests.sh']
  env:
    BLOCKDEVICES: 'sda sdb'

- id: download results
  uses: docker://bitnami/kubectl:1.17.4
  runs: ['./dd/download_results.sh']

- id: teardown dd tests
  uses: docker://bitnami/kubectl:1.17.4
  runs: ['./dd/teardown_dd_tests.sh']
